# Enumération sous Linux

## Shell ergonomique
Shell de base :
```bash
$ python -c "import pty;pty.spawn('/bin/sh')"
```
Shell full interactif :
```bash
$ python3 -c 'import pty; pty.spawn("/bin/bash")'
# faire un Ctrl + Z
$ stty raw -echo
$ fg
```

### Voir les droits de l'utilisateur courant 
```bash
$ sudo -l
```
Si nous avons le droit d'executer un binaire avec les droits roots, regarder sur GTFOBin :</br>
<https://gtfobins.github.io/></br>

### Trouver des fichiers avec la permission SUID ou SGID
```bash
$ find / -perm -g=s -type f 2>/dev/null
$ find / -perm -u=s -type f 2>/dev/null
```

### Trouver des dossiers avec le droit d'écrire ou d'executer
```bash
$ find / -writable -type d 2>/dev/null
$ find / -perm -o w -type d 2>/dev/null
$ find / -perm -o x -type d 2>/dev/null
``` 

### Lister les processus qui tournent
```bash
$ ps aux
```

### Lister les port ouverts
```bash
$ netstat -anop
```

### Créer un utilisateur
Faire un user dans /etc/passwd, sachant que le format est : **{username}:{resultatcommandecidessous}:0:0:root:/bin/bash**
```bash
$ openssl passwd -1 -salt {username} {password}
```

### Binaire pour énumération :
Avec LinEnum :</br>
<https://github.com/rebootuser/LinEnum></br>
Avec LinPeas :</br>
<https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS></br>
Avec Linux-Priv-Checker :</br>
<https://gist.github.com/sh1n0b1/e2e1a5f63fbec3706123></br>
Avec Pspy64 :</br>
<https://github.com/DominicBreuker/pspy></br>

### DirtyCow (suivant la version du linux)
<https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs></br>

### Kernel exploits (suivant la version du noyau)
<https://github.com/xairy/kernel-exploits></br>
<https://github.com/SecWiki/linux-kernel-exploits></br>

### Checker si y'a moyen de faire une escalation
<https://github.com/pentestmonkey/unix-privesc-check></br>

### Linux privilege escalation guide
<http://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/></br>

# Enumération sous windows

## Checker les logiciels
On vérifie les programmes d'installés, des creds sont peut être dans les fichiers de configurations..
```bash
> dir C:\Program File\
```

## Informations systèmes avec meterpreter
```bash
meterpreter > sysinfo
```
Penser a migrer le processus en 64 bits si il est en 32 :
```bash
meterpreter > ps
meterpreter > migrate {PID}
```

## Sous meterpreter, faire un check des exploits disponibles 
```bash
meterpreter > run post/multi/recon/local_exploit_suggester
```

## Living Off the Land (LOLBINS)
<https://github.com/LOLBAS-Project/LOLBAS></br>

## Quel est l'OS et l'architecture ?
```bash
> systeminfo
```

## Qui suis-je ?
```bash
> whoami
```

## Quels sont mes privilèges ?
```bash
> whoami /priv
```

## Quels autres utilisateurs sont connectés ?
```bash
> qwinsta
```

## Quels sont les groupes sur le système ?
```bash
> net localgroup
```

## Qui appartient au groupe Administrators ?
```bash
> net localgroup Administrators
```

## Des données dans le Crediential Manager ?
```bash
> cmdkey /list
> dir C:\Users\username\AppData\Local\Microsoft\Credentials\
> dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
> Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
> Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
```

## Accès à la base SAM et aux fichiers systèmes ?
```bash
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
```

## Quels sont les logiciels installés ?
```bash
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE
Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name*
```

## Est-ce que des dossiers ont des permissions trop larges ?
```bash
icacls "C:\Program Files\*" 2>nul | findstr "(F)" | findstr "Everyone"
icacls "C:\Program Files (x86)\*" 2>nul | findstr "(F)" | findstr "Everyone"
icacls "C:\Program Files\*" 2>nul | findstr "(F)" | findstr "BUILTIN\Users"
icacls "C:\Program Files (x86)\*" 2>nul | findstr "(F)" | findstr "BUILTIN\Users" 
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}} 
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}} 
```

## Checker les fichiers et dossiers disponibles en écriture
On test via le script accesschk (de sysinternals), mais il faut l'upload sur la machine distante.
```bash
accesschk.exe -qwsu "Everyone" *
accesschk.exe -qwsu "Authenticated Users" *
accesschk.exe -qwsu "Users" *
```

## Quels sont les processus/services en cours d'utilisation ?
```bash
tasklist /svc
tasklist /v
net start
sc query
```

## Quels sont les tâches planifiées ?
```bash
schtasks /query /fo LIST 2>nul | findstr TaskName
dir C:\windows\tasks
```

## Qu'est-ce qui est lancé au démarrage ?
```bash
wmic startup get caption,command
dir "C:\Documents and Settings\All Users\Start Menu\Programs\Startup"
dir "C:\Documents and Settings\%username%\Start Menu\Programs\Startup"
Get-ChildItem "C:\Users\All Users\Start Menu\Programs\Startup"
Get-ChildItem "C:\Users\$env:USERNAME\Start Menu\Programs\Startup"
```