#### Commande de bases
# Meilleur shell
$ python -c "import pty;pty.spawn('/bin/sh')"

## Shell full interactif
$ python3 -c 'import pty; pty.spawn("/bin/bash")'
Ctrl + Z
$ stty raw -echo
$ fg

# voir les commandes qui peuvent être executées avec l'utilisateur courant
$ sudo -l

# Trouver des fichiers avec la permission SUID ou SGID
$ find / -perm -g=s -type f 2>/dev/null
$ find / -perm -u=s -type f 2>/dev/null

# Trouver des dossiers avec le droit d'écrire ou d'executer
$ find / -writable -type d 2>/dev/null
$ find / -perm -o w -type d 2>/dev/null
$ find / -perm -o x -type d 2>/dev/null

# Lister les processus qui tournent
$ ps aux

# lister les port ouverts
$ netstat -anop

# Faire un user en format /etc/passwd
# format : {username}:{resultatcommandecidessous}:0:0:root:/bin/bash
$ openssl passwd -1 -salt {username} {password}

#### DirtyCow (suivant la version du linux)
https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs

#### Kernel exploits (suivant la version du noyau)
https://github.com/xairy/kernel-exploits
https://github.com/SecWiki/linux-kernel-exploits

#### Checker si y'a moyen de faire une escalation
https://github.com/pentestmonkey/unix-privesc-check

#### LinEnum : enumeration massive du systeme (AkA ton meilleur pote)
https://github.com/rebootuser/LinEnum

#### linuxprivchecker.py : enumeration et tente des escalations
https://gist.github.com/sh1n0b1/e2e1a5f63fbec3706123

#### Linux privilege escalation guide
http://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/

#### GTFOBIN
https://gtfobins.github.io/

############### Sous windows
###Privilège escalation :
## Checker les logiciels et si des creds sont dedans (ancien cred ou d'actualité (password reuse))
## Utiliser sysinfo de meterpreter pour les infos
## Penser a migrer le processus en 64 bits si il est en 32 (ou simplement pour la discrétin tmtc)
meterpreter > sysinfo
meterpreter > ps
meterpreter > migrate {PID}

## On tente de voir les différents exploits dispo, sous meterpreter 
meterpreter > run post/multi/recon/local_exploit_suggester

## Living Off the Land (LOLBINS)
https://github.com/LOLBAS-Project/LOLBAS

## Enum de base 
> systeminfo				= What is the OS and architecture ?
> whoami				= Qui suis-je ?
> whoami /priv				= Mes privilèges ?
> qwinsta				= Quel autre utilisateur est connecté ?
> net localgroup			= Quels sont les groupes sur le système ?
> net localgroup Administrators		= Qui appartient au groupe Administrators ?
--- Quelques choses d'intéréssant dans le credential Manager ?
> cmdkey /list
> dir C:\Users\username\AppData\Local\Microsoft\Credentials\
> dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
> Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
> Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
--- 
--- On a accès à la base SAM et aux fichiers system ?
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
---
--- Quels sont les logiciels installés ?
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE
Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name*
---
--- Est-ce que des dossiers ont des permissions trop larges ?
icacls "C:\Program Files\*" 2>nul | findstr "(F)" | findstr "Everyone"
icacls "C:\Program Files (x86)\*" 2>nul | findstr "(F)" | findstr "Everyone"
icacls "C:\Program Files\*" 2>nul | findstr "(F)" | findstr "BUILTIN\Users"
icacls "C:\Program Files (x86)\*" 2>nul | findstr "(F)" | findstr "BUILTIN\Users" 
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}} 

Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}} 
---
--- On peut upload accesschk (de Sysinternals) pour checker les fichiers et dossiers dispo en écriture
accesschk.exe -qwsu "Everyone" *
accesschk.exe -qwsu "Authenticated Users" *
accesschk.exe -qwsu "Users" *
---
--- Quels sont les processus/services en cours d'utilisation ?
tasklist /svc
tasklist /v
net start
sc query
---
--- Quels sont les taches planifiés ?
schtasks /query /fo LIST 2>nul | findstr TaskName
dir C:\windows\tasks
---
--- Qu'est-ce qui est lancé au démarrage ?
wmic startup get caption,command
dir "C:\Documents and Settings\All Users\Start Menu\Programs\Startup"
dir "C:\Documents and Settings\%username%\Start Menu\Programs\Startup"
Get-ChildItem "C:\Users\All Users\Start Menu\Programs\Startup"
Get-ChildItem "C:\Users\$env:USERNAME\Start Menu\Programs\Startup"
---

[[[NETWORKING]]]